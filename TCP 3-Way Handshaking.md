# TCP 3-Way Handshaking (μ”μ•½)

TCP μ—°κ²°μ„ λ§Ίμ„ λ• ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ μ„λ΅ ν†µμ‹  κ°€λ¥ μ—¬λ¶€μ™€ **μ΄κΈ° μ‹ν€€μ¤ λ²νΈ(ISN)**λ¥Ό ν™•μΈν•λ” μ μ°¨.

---

## 1. κ³Όμ • (3λ‹¨κ³„)

1. **SYN**  
   ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ : μ—°κ²° μ”μ²­ (`seq = x`)

2. **SYN + ACK**  
   μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ : μ”μ²­ μλ½ + μ„λ²„ ISN μ μ‹ (`seq = y, ack = x+1`)

3. **ACK**  
   ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ : μ„λ²„ ISN ν™•μΈ (`ack = y+1`)

β†’ μ΄ κ³Όμ •μ„ κ±°μΉλ©΄ **μ–‘λ°©ν–¥ ν†µμ‹  μ¤€λΉ„ μ™„λ£ (ESTABLISHED)**

---

## 2. λ‹¤μ΄μ–΄κ·Έλ¨

```text
Client                        Server
  | ---- SYN (x) -----------> |
  | <--- SYN+ACK (y, ack=x+1) |
  | ---- ACK (ack=y+1) -----> |
```

---

## 3. νΉμ§• (Features)

- **μ–‘λ°©ν–¥ ν™•μΈ**  
  ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ μ„λ΅ λ°μ΄ν„°λ¥Ό **λ³΄λ‚΄κ³  λ°›μ„ μ μμ**μ„ ν™•μΈν•λ‹¤.

- **μ΄κΈ° μ‹ν€€μ¤ λ²νΈ(ISN) λ™κΈ°ν™”**  
  - λ°μ΄ν„° μ „μ†΅ μ‹μ‘ λ²νΈλ¥Ό μΌμΉμ‹ν‚¨λ‹¤.  
  - μ§€μ—°λ κ³Όκ±° ν¨ν‚·μ΄ μƒλ΅μ΄ μ—°κ²°μ— νΌμ…λλ” κ²ƒμ„ λ°©μ§€ν•λ‹¤.  
  - μμΈ΅ λ¶κ°€λ¥ν• ISNμ„ μ‚¬μ©ν•΄ λ³΄μ•μ„±μ„ κ°•ν™”ν•λ‹¤. (μ„Έμ… ν•μ΄μ¬ν‚Ή λ°©μ–΄)

- **μµμ… ν‘μƒ**  
  MSS, μλ„μ° ν¬κΈ°, SACK, Timestamp λ“±μ **TCP μµμ…μ„ κµν™**ν•λ‹¤.

---

## 4. λ¬Έμ  μƒν™©: SYN μμ‹  μ‹¤ν¨ μ‹ κ³ λ ¤ μ‚¬ν•­ (Troubleshooting)

μ„λ²„κ°€ SYNμ„ λ°›μ§€ λ»ν• κ²½μ° μ κ²€ν•΄μ•Ό ν•  μ”μ†:

- **μ„λ²„ μƒνƒ**  
  - μ„λ²„ ν”„λ΅μ„Έμ¤ λ―ΈκΈ°λ™  
  - ν¬νΈκ°€ LISTEN μƒνƒκ°€ μ•„λ‹  

- **λ„¤νΈμ›ν¬/λ³΄μ• μ¥λΉ„**  
  - λ°©ν™”λ²½(ACL)μ—μ„ SYN ν¨ν‚· λ“λ΅­  
  - L4 μ¤μ„μΉλ‚ λ΅λ“λ°Έλ°μ„ μ •μ±… λ¬Έμ   

- **NAT / λΌμ°ν… λ¬Έμ **  
  - NAT ν…μ΄λΈ”μ΄ μƒμ„±λμ§€ μ•μ•κ±°λ‚ λ§λ£λ¨  
  - κ²½λ΅ μƒ λΌμ°ν… μ¤λ¥  

- **λ¬Όλ¦¬μ  λ„¤νΈμ›ν¬ λ‹¨μ **  
  - μΌ€μ΄λΈ” λ¶λ‰  
  - μ¤μ„μΉ/λΌμ°ν„° μ¥μ•   

π‘‰ μ΄λ° κ²½μ° ν΄λΌμ΄μ–ΈνΈλ” `SYN_SENT` μƒνƒμ—μ„ SYNμ„ **μ¬μ „μ†΅**λ§ ν•λ‹¤κ°€ μµμΆ…μ μΌλ΅ νƒ€μ„μ•„μ›ƒλλ‹¤.  
