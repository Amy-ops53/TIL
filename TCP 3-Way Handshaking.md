# TCP 3-Way Handshaking (μ”μ•½)

TCP μ—°κ²°μ„ λ§Ίμ„ λ• ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ μ„λ΅ ν†µμ‹  κ°€λ¥ μ—¬λ¶€μ™€ **μ΄κΈ° μ‹ν€€μ¤ λ²νΈ(ISN)**λ¥Ό ν™•μΈν•λ” μ μ°¨.

---

## 1. κ³Όμ • (3λ‹¨κ³„)

1. **SYN**  
   ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ : μ—°κ²° μ”μ²­ (`seq = x`)

2. **SYN + ACK**  
   μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ : μ”μ²­ μλ½ + μ„λ²„ ISN μ μ‹ (`seq = y, ack = x+1`)

3. **ACK**  
   ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ : μ„λ²„ ISN ν™•μΈ (`ack = y+1`)

β†’ μ΄ κ³Όμ •μ„ κ±°μΉλ©΄ **μ–‘λ°©ν–¥ ν†µμ‹  μ¤€λΉ„ μ™„λ£ (ESTABLISHED)**

---

## 2. λ‹¤μ΄μ–΄κ·Έλ¨

```text
Client                        Server
  | ---- SYN (x) -----------> |
  | <--- SYN+ACK (y, ack=x+1) |
  | ---- ACK (ack=y+1) -----> |

---

## 3. νΉμ§• (Features)

- **μ–‘λ°©ν–¥ ν™•μΈ**  
  ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ μ„λ΅ **λ³΄λ‚΄κΈ°Β·λ°›κΈ° λ¨λ‘ κ°€λ¥**ν•¨μ„ ν™•μΈν•λ‹¤.

- **μ΄κΈ° μ‹ν€€μ¤ λ²νΈ(ISN) λ™κΈ°ν™”**  
  - λ°μ΄ν„° μ „μ†΅ μ‹μ‘ λ²νΈλ¥Ό λ§μ¶λ‹¤.  
  - μ§€μ—°λ κ³Όκ±° ν¨ν‚·κ³Όμ μ¶©λμ„ λ°©μ§€ν•λ‹¤.  
  - μμΈ΅ λ¶κ°€λ¥ν• ISNμΌλ΅ λ³΄μ•μ„±μ„ κ°•ν™”ν•λ‹¤. (μ„Έμ… ν•μ΄μ¬ν‚Ή λ°©μ–΄)

- **μµμ… ν‘μƒ**  
  ν•Έλ“μ…°μ΄ν¬ κ³Όμ •μ—μ„ MSS, μλ„μ° ν¬κΈ°, SACK, Timestamp λ“±μ **ν†µμ‹  μµμ…μ„ κµν™**ν•λ‹¤.  

---

## 4. λ¬Έμ  μƒν™©: SYN μμ‹  μ‹¤ν¨ μ‹ κ³ λ ¤ μ‚¬ν•­ (Troubleshooting)

λ§μ•½ μ„λ²„κ°€ SYNμ„ λ°›μ§€ λ»ν–λ‹¤λ©΄, μ•„λ μ”μ†λ“¤μ„ μ κ²€ν•΄μ•Ό ν•λ‹¤.

- **μ„λ²„ μƒνƒ**  
  - ν”„λ΅μ„Έμ¤κ°€ λ―ΈκΈ°λ™ μƒνƒ  
  - ν•΄λ‹Ή ν¬νΈκ°€ LISTEN μƒνƒκ°€ μ•„λ‹  

- **λ„¤νΈμ›ν¬/λ³΄μ• μ¥λΉ„**  
  - λ°©ν™”λ²½(ACL)μ—μ„ SYN λ“λ΅­  
  - L4 μ¤μ„μΉλ‚ λ΅λ“λ°Έλ°μ„ μ •μ±… λ¬Έμ   

- **NAT / λΌμ°ν… λ¬Έμ **  
  - NAT ν…μ΄λΈ” λ―Έμƒμ„± λλ” λ§λ£  
  - κ²½λ΅ μƒ λΌμ°ν… μ¤λ¥  

- **λ¬Όλ¦¬μ  λ„¤νΈμ›ν¬ λ‹¨μ **  
  - μΌ€μ΄λΈ” λ¶λ‰, μ¤μ„μΉ/λΌμ°ν„° μ¥μ•   

π‘‰ μ΄λ° κ²½μ°, ν΄λΌμ΄μ–ΈνΈλ” `SYN_SENT` μƒνƒμ—μ„ SYNμ„ **μ¬μ „μ†΅**λ§ λ°λ³µν•λ‹¤κ°€ μµμΆ…μ μΌλ΅ νƒ€μ„μ•„μ›ƒλλ‹¤.
