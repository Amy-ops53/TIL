# TCP 3-Way Handshaking (요약)

TCP 연결을 맺을 때 클라이언트와 서버가 서로 통신 가능 여부와 **초기 시퀀스 번호(ISN)**를 확인하는 절차.

---

## 1. 과정 (3단계)

1. **SYN**  
   클라이언트 → 서버 : 연결 요청 (`seq = x`)

2. **SYN + ACK**  
   서버 → 클라이언트 : 요청 수락 + 서버 ISN 제시 (`seq = y, ack = x+1`)

3. **ACK**  
   클라이언트 → 서버 : 서버 ISN 확인 (`ack = y+1`)

→ 이 과정을 거치면 **양방향 통신 준비 완료 (ESTABLISHED)**

---

## 2. 다이어그램

```text
Client                        Server
  | ---- SYN (x) -----------> |
  | <--- SYN+ACK (y, ack=x+1) |
  | ---- ACK (ack=y+1) -----> |
```

---

## 3. 특징 (Features)

- **양방향 확인**  
  클라이언트와 서버가 서로 데이터를 **보내고 받을 수 있음**을 확인한다.

- **초기 시퀀스 번호(ISN) 동기화**  
  - 데이터 전송 시작 번호를 일치시킨다.  
  - 지연된 과거 패킷이 새로운 연결에 혼입되는 것을 방지한다.  
  - 예측 불가능한 ISN을 사용해 보안성을 강화한다. (세션 하이재킹 방어)

- **옵션 협상**  
  MSS, 윈도우 크기, SACK, Timestamp 등의 **TCP 옵션을 교환**한다.

---

## 4. 문제 상황: SYN 수신 실패 시 고려 사항 (Troubleshooting)

서버가 SYN을 받지 못한 경우 점검해야 할 요소:

- **서버 상태**  
  - 서버 프로세스 미기동  
  - 포트가 LISTEN 상태가 아님  

- **네트워크/보안 장비**  
  - 방화벽(ACL)에서 SYN 패킷 드롭  
  - L4 스위치나 로드밸런서 정책 문제  

- **NAT / 라우팅 문제**  
  - NAT 테이블이 생성되지 않았거나 만료됨  
  - 경로 상 라우팅 오류  

- **물리적 네트워크 단절**  
  - 케이블 불량  
  - 스위치/라우터 장애  

👉 이런 경우 클라이언트는 `SYN_SENT` 상태에서 SYN을 **재전송**만 하다가 최종적으로 타임아웃된다.  
